<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">wav2vec-u CV-sv - w2vu_generate</h1><p class="page-description">w2vu_generate on Common Voice Swedish</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-06-19T00:00:00-05:00" itemprop="datePublished">
        Jun 19, 2021
      </time>
       ‚Ä¢ <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/notes/categories/#colab">colab</a>
        &nbsp;
      
        <a class="category-tags-link" href="/notes/categories/#wav2vec-u">wav2vec-u</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/jimregan/notes/tree/master/_notebooks/2021-06-19-wav2vec-u-cv-swedish-w2vu-generate.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/notes/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/jimregan/notes/master?filepath=_notebooks%2F2021-06-19-wav2vec-u-cv-swedish-w2vu-generate.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/notes/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/jimregan/notes/blob/master/_notebooks/2021-06-19-wav2vec-u-cv-swedish-w2vu-generate.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/notes/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-06-19-wav2vec-u-cv-swedish-w2vu-generate.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is based on <a href="/notes/kaggle/colab/wav2vec-u/2021/05/30/wav2vec-u-cv-swedish-gan.html">this</a>. The main difference is the script that's being run, and setting up <a href="https://github.com/flashlight/flashlight/tree/master/bindings/python">flashlight's python bindings</a></p>
<p>I already had the GAN model in gdrive; those files are available <a href="https://www.kaggle.com/jimregan/download-w2vu-sv-model-trained-on-colab">here</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preparation">Preparation<a class="anchor-link" href="#Preparation"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install condacolab
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Collecting condacolab
  Using cached condacolab-0.1.2-py3-none-any.whl (6.0 kB)
Installing collected packages: condacolab
Successfully installed condacolab-0.1.2
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">condacolab</span>
<span class="n">condacolab</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>‚ú®üç∞‚ú® Everything looks OK!
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">pykaldi</span> <span class="n">pykaldi</span> <span class="o">-</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>git clone https://github.com/pytorch/fairseq/
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>fatal: destination path &#39;fairseq&#39; already exists and is not an empty directory.
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>git clone https://github.com/kpu/kenlm
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>fatal: destination path &#39;kenlm&#39; already exists and is not an empty directory.
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">libeigen3</span><span class="o">-</span><span class="n">dev</span> <span class="n">liblzma</span><span class="o">-</span><span class="n">dev</span> <span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span> <span class="n">libbz2</span><span class="o">-</span><span class="n">dev</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The python build doesn't build utils, so this is (probably) necessary</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> /content/kenlm
<span class="o">!</span>mkdir build
<span class="o">%</span><span class="k">cd</span> build
<span class="o">!</span>cmake ..
<span class="o">!</span>make -j <span class="m">4</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="o">%</span><span class="n">cd</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">kenlm</span>
<span class="err">!</span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
<span class="o">%</span><span class="n">cd</span> <span class="o">/</span><span class="n">tmp</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:/content/kenlm/build/bin/&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;FAIRSEQ_ROOT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/content/fairseq&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> /content/fairseq/
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/content/fairseq
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For next cell, see <a href="https://github.com/pytorch/fairseq/issues/3087">here</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">editable</span> <span class="o">./</span>
<span class="err">!</span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span> <span class="n">develop</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HYDRA_FULL_ERROR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">editdistance</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://colab.research.google.com/github/corrieann/kaggle/blob/master/kaggle_api_in_colab.ipynb">https://colab.research.google.com/github/corrieann/kaggle/blob/master/kaggle_api_in_colab.ipynb</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">kaggle</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>

<span class="n">uploaded</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>

<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">uploaded</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;User uploaded file &quot;</span><span class="si">{name}</span><span class="s1">&quot; with length </span><span class="si">{length}</span><span class="s1"> bytes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
      <span class="n">name</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">uploaded</span><span class="p">[</span><span class="n">fn</span><span class="p">])))</span>
  
<span class="c1"># Then move kaggle.json into the folder where the API expects to find it.</span>
<span class="o">!</span>mkdir -p ~/.kaggle/ <span class="o">&amp;&amp;</span> mv kaggle.json ~/.kaggle/ <span class="o">&amp;&amp;</span> chmod <span class="m">600</span> ~/.kaggle/kaggle.json
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

     <input type="file" id="files-5a377664-3c2b-45db-a36d-da7b86c716a2" name="files[]" multiple="" disabled="" style="border:none" />
     <output id="result-5a377664-3c2b-45db-a36d-da7b86c716a2">
      Upload widget is only available when the cell has been executed in the
      current browser session. Please rerun this cell to enable.
      </output>
      <script src="/nbextensions/google.colab/files.js"></script> 
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Saving kaggle.json to kaggle.json
User uploaded file &#34;kaggle.json&#34; with length 64 bytes
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> /content
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/content
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>kaggle datasets download <span class="s2">&quot;jimregan/w2vu-cvsv-audio-processed&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Downloading w2vu-cvsv-audio-processed.zip to /content
100% 4.31G/4.31G [01:24&lt;00:00, 102MB/s] 
100% 4.31G/4.31G [01:24&lt;00:00, 54.7MB/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">unzip</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">w2vu</span><span class="o">-</span><span class="n">cvsv</span><span class="o">-</span><span class="n">audio</span><span class="o">-</span><span class="n">processed</span><span class="o">.</span><span class="n">zip</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>kaggle datasets download -d jimregan/w2vu-cvsv-prepared-text
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Downloading w2vu-cvsv-prepared-text.zip to /content
 80% 14.0M/17.4M [00:00&lt;00:00, 33.7MB/s]
100% 17.4M/17.4M [00:00&lt;00:00, 44.2MB/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">unzip</span> <span class="n">w2vu</span><span class="o">-</span><span class="n">cvsv</span><span class="o">-</span><span class="n">prepared</span><span class="o">-</span><span class="n">text</span><span class="o">.</span><span class="n">zip</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>rm *.zip
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cp /content/preppedtext/phones/dict* /content/precompute_pca512_cls128_mean
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> /content
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/content
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>git clone https://github.com/flashlight/flashlight
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Cloning into &#39;flashlight&#39;...
remote: Enumerating objects: 17649, done.
remote: Counting objects: 100% (1523/1523), done.
remote: Compressing objects: 100% (718/718), done.
remote: Total 17649 (delta 827), reused 1336 (delta 761), pack-reused 16126
Receiving objects: 100% (17649/17649), 14.23 MiB | 24.82 MiB/s, done.
Resolving deltas: 100% (12298/12298), done.
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">libfftw3</span><span class="o">-</span><span class="n">dev</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Reading package lists...
Building dependency tree...
Reading state information...
libfftw3-dev is already the newest version (3.3.7-1).
cmake is already the newest version (3.10.2-1ubuntu2.18.04.1).
0 upgraded, 0 newly installed, 0 to remove and 39 not upgraded.
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> flashlight/bindings/python
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/content/flashlight/bindings/python
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%capture</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">packaging</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span><span class="nv">USE_MKL</span><span class="o">=</span><span class="m">0</span> <span class="nv">KENLM_ROOT</span><span class="o">=</span>/content/kenlm python setup.py install
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="w2vu-generate">w2vu-generate<a class="anchor-link" href="#w2vu-generate"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="n">torch</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">cuda</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;10.2&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>7605</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> /content/fairseq
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/content/fairseq
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Mounted at /content/drive
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> /content/fairseq/examples/wav2vec/unsupervised
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/content/fairseq/examples/wav2vec/unsupervised
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%writefile</span> rungan.sh
<span class="n">python</span> <span class="n">w2vu_generate</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span><span class="o">-</span><span class="nb">dir</span> <span class="n">config</span><span class="o">/</span><span class="n">generate</span> <span class="o">--</span><span class="n">config</span><span class="o">-</span><span class="n">name</span> <span class="n">viterbi</span> \
<span class="n">fairseq</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">user_dir</span><span class="o">=/</span><span class="n">content</span><span class="o">/</span><span class="n">fairseq</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">wav2vec</span><span class="o">/</span><span class="n">unsupervised</span> \
<span class="n">fairseq</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">data</span><span class="o">=/</span><span class="n">content</span><span class="o">/</span><span class="n">precompute_pca512_cls128_mean</span> \
<span class="n">fairseq</span><span class="o">.</span><span class="n">common_eval</span><span class="o">.</span><span class="n">path</span><span class="o">=/</span><span class="n">content</span><span class="o">/</span><span class="n">drive</span><span class="o">/</span><span class="n">MyDrive</span><span class="o">/</span><span class="n">w2vu</span><span class="o">/</span><span class="n">checkpoint_best</span><span class="o">.</span><span class="n">pt</span> \
<span class="n">fairseq</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">gen_subset</span><span class="o">=</span><span class="n">valid</span> <span class="n">results_path</span><span class="o">=/</span><span class="n">content</span><span class="o">/</span><span class="n">drive</span><span class="o">/</span><span class="n">MyDrive</span><span class="o">/</span><span class="n">w2vures</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting rungan.sh
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>bash rungan.sh
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[2021-06-19 19:24:18,601][__main__][INFO] - {&#39;_name&#39;: None, &#39;fairseq&#39;: {&#39;_name&#39;: None, &#39;common&#39;: {&#39;_name&#39;: None, &#39;no_progress_bar&#39;: False, &#39;log_interval&#39;: 100, &#39;log_format&#39;: None, &#39;log_file&#39;: None, &#39;tensorboard_logdir&#39;: None, &#39;wandb_project&#39;: None, &#39;azureml_logging&#39;: False, &#39;seed&#39;: 1, &#39;cpu&#39;: False, &#39;tpu&#39;: False, &#39;bf16&#39;: False, &#39;memory_efficient_bf16&#39;: False, &#39;fp16&#39;: False, &#39;memory_efficient_fp16&#39;: False, &#39;fp16_no_flatten_grads&#39;: False, &#39;fp16_init_scale&#39;: 128, &#39;fp16_scale_window&#39;: None, &#39;fp16_scale_tolerance&#39;: 0.0, &#39;on_cpu_convert_precision&#39;: False, &#39;min_loss_scale&#39;: 0.0001, &#39;threshold_loss_scale&#39;: None, &#39;amp&#39;: False, &#39;amp_batch_retries&#39;: 2, &#39;amp_init_scale&#39;: 128, &#39;amp_scale_window&#39;: None, &#39;user_dir&#39;: &#39;/content/fairseq/examples/wav2vec/unsupervised&#39;, &#39;empty_cache_freq&#39;: 0, &#39;all_gather_list_size&#39;: 16384, &#39;model_parallel_size&#39;: 1, &#39;quantization_config_path&#39;: None, &#39;profile&#39;: False, &#39;reset_logging&#39;: False, &#39;suppress_crashes&#39;: False, &#39;use_plasma_view&#39;: False, &#39;plasma_path&#39;: &#39;/tmp/plasma&#39;}, &#39;common_eval&#39;: {&#39;_name&#39;: None, &#39;path&#39;: &#39;/content/drive/MyDrive/w2vu/checkpoint_best.pt&#39;, &#39;post_process&#39;: None, &#39;quiet&#39;: True, &#39;model_overrides&#39;: &#39;{}&#39;, &#39;results_path&#39;: None}, &#39;distributed_training&#39;: {&#39;_name&#39;: None, &#39;distributed_world_size&#39;: 1, &#39;distributed_num_procs&#39;: 1, &#39;distributed_rank&#39;: 0, &#39;distributed_backend&#39;: &#39;nccl&#39;, &#39;distributed_init_method&#39;: None, &#39;distributed_port&#39;: -1, &#39;device_id&#39;: 0, &#39;distributed_no_spawn&#39;: False, &#39;ddp_backend&#39;: pytorch_ddp, &#39;ddp_comm_hook&#39;: none, &#39;bucket_cap_mb&#39;: 25, &#39;fix_batches_to_gpus&#39;: False, &#39;find_unused_parameters&#39;: False, &#39;fast_stat_sync&#39;: False, &#39;heartbeat_timeout&#39;: -1, &#39;broadcast_buffers&#39;: False, &#39;slowmo_momentum&#39;: None, &#39;slowmo_algorithm&#39;: &#39;LocalSGD&#39;, &#39;localsgd_frequency&#39;: 3, &#39;nprocs_per_node&#39;: 1, &#39;pipeline_model_parallel&#39;: False, &#39;pipeline_balance&#39;: None, &#39;pipeline_devices&#39;: None, &#39;pipeline_chunks&#39;: 0, &#39;pipeline_encoder_balance&#39;: None, &#39;pipeline_encoder_devices&#39;: None, &#39;pipeline_decoder_balance&#39;: None, &#39;pipeline_decoder_devices&#39;: None, &#39;pipeline_checkpoint&#39;: never, &#39;zero_sharding&#39;: none, &#39;fp16&#39;: &#39;${common.fp16}&#39;, &#39;memory_efficient_fp16&#39;: &#39;${common.memory_efficient_fp16}&#39;, &#39;tpu&#39;: &#39;${common.tpu}&#39;, &#39;no_reshard_after_forward&#39;: False, &#39;fp32_reduce_scatter&#39;: False, &#39;cpu_offload&#39;: False, &#39;use_sharded_state&#39;: False}, &#39;dataset&#39;: {&#39;_name&#39;: None, &#39;num_workers&#39;: 1, &#39;skip_invalid_size_inputs_valid_test&#39;: False, &#39;max_tokens&#39;: None, &#39;batch_size&#39;: 1, &#39;required_batch_size_multiple&#39;: 8, &#39;required_seq_len_multiple&#39;: 1, &#39;dataset_impl&#39;: None, &#39;data_buffer_size&#39;: 10, &#39;train_subset&#39;: &#39;train&#39;, &#39;valid_subset&#39;: &#39;valid&#39;, &#39;combine_valid_subsets&#39;: None, &#39;ignore_unused_valid_subsets&#39;: False, &#39;validate_interval&#39;: 1, &#39;validate_interval_updates&#39;: 0, &#39;validate_after_updates&#39;: 0, &#39;fixed_validation_seed&#39;: None, &#39;disable_validation&#39;: False, &#39;max_tokens_valid&#39;: &#39;${dataset.max_tokens}&#39;, &#39;batch_size_valid&#39;: &#39;${dataset.batch_size}&#39;, &#39;max_valid_steps&#39;: None, &#39;curriculum&#39;: 0, &#39;gen_subset&#39;: &#39;valid&#39;, &#39;num_shards&#39;: 1, &#39;shard_id&#39;: 0}, &#39;optimization&#39;: {&#39;_name&#39;: None, &#39;max_epoch&#39;: 0, &#39;max_update&#39;: 0, &#39;stop_time_hours&#39;: 0.0, &#39;clip_norm&#39;: 0.0, &#39;sentence_avg&#39;: False, &#39;update_freq&#39;: [1], &#39;lr&#39;: [0.25], &#39;stop_min_lr&#39;: -1.0, &#39;use_bmuf&#39;: False}, &#39;checkpoint&#39;: {&#39;_name&#39;: None, &#39;save_dir&#39;: &#39;checkpoints&#39;, &#39;restore_file&#39;: &#39;checkpoint_last.pt&#39;, &#39;finetune_from_model&#39;: None, &#39;reset_dataloader&#39;: False, &#39;reset_lr_scheduler&#39;: False, &#39;reset_meters&#39;: False, &#39;reset_optimizer&#39;: False, &#39;optimizer_overrides&#39;: &#39;{}&#39;, &#39;save_interval&#39;: 1, &#39;save_interval_updates&#39;: 0, &#39;keep_interval_updates&#39;: -1, &#39;keep_interval_updates_pattern&#39;: -1, &#39;keep_last_epochs&#39;: -1, &#39;keep_best_checkpoints&#39;: -1, &#39;no_save&#39;: False, &#39;no_epoch_checkpoints&#39;: False, &#39;no_last_checkpoints&#39;: False, &#39;no_save_optimizer_state&#39;: False, &#39;best_checkpoint_metric&#39;: &#39;loss&#39;, &#39;maximize_best_checkpoint_metric&#39;: False, &#39;patience&#39;: -1, &#39;checkpoint_suffix&#39;: &#39;&#39;, &#39;checkpoint_shard_count&#39;: 1, &#39;load_checkpoint_on_all_dp_ranks&#39;: False, &#39;write_checkpoints_asynchronously&#39;: False, &#39;model_parallel_size&#39;: &#39;${common.model_parallel_size}&#39;}, &#39;bmuf&#39;: {&#39;_name&#39;: None, &#39;block_lr&#39;: 1.0, &#39;block_momentum&#39;: 0.875, &#39;global_sync_iter&#39;: 50, &#39;warmup_iterations&#39;: 500, &#39;use_nbm&#39;: False, &#39;average_sync&#39;: False, &#39;distributed_world_size&#39;: &#39;${distributed_training.distributed_world_size}&#39;}, &#39;generation&#39;: {&#39;_name&#39;: None, &#39;beam&#39;: 5, &#39;nbest&#39;: 1, &#39;max_len_a&#39;: 0.0, &#39;max_len_b&#39;: 200, &#39;min_len&#39;: 1, &#39;match_source_len&#39;: False, &#39;unnormalized&#39;: False, &#39;no_early_stop&#39;: False, &#39;no_beamable_mm&#39;: False, &#39;lenpen&#39;: 1.0, &#39;unkpen&#39;: 0.0, &#39;replace_unk&#39;: None, &#39;sacrebleu&#39;: False, &#39;score_reference&#39;: False, &#39;prefix_size&#39;: 0, &#39;no_repeat_ngram_size&#39;: 0, &#39;sampling&#39;: False, &#39;sampling_topk&#39;: -1, &#39;sampling_topp&#39;: -1.0, &#39;constraints&#39;: None, &#39;temperature&#39;: 1.0, &#39;diverse_beam_groups&#39;: -1, &#39;diverse_beam_strength&#39;: 0.5, &#39;diversity_rate&#39;: -1.0, &#39;print_alignment&#39;: None, &#39;print_step&#39;: False, &#39;lm_path&#39;: None, &#39;lm_weight&#39;: 0.0, &#39;iter_decode_eos_penalty&#39;: 0.0, &#39;iter_decode_max_iter&#39;: 10, &#39;iter_decode_force_max_iter&#39;: False, &#39;iter_decode_with_beam&#39;: 1, &#39;iter_decode_with_external_reranker&#39;: False, &#39;retain_iter_history&#39;: False, &#39;retain_dropout&#39;: False, &#39;retain_dropout_modules&#39;: None, &#39;decoding_format&#39;: None, &#39;no_seed_provided&#39;: False}, &#39;eval_lm&#39;: {&#39;_name&#39;: None, &#39;output_word_probs&#39;: False, &#39;output_word_stats&#39;: False, &#39;context_window&#39;: 0, &#39;softmax_batch&#39;: 9223372036854775807}, &#39;interactive&#39;: {&#39;_name&#39;: None, &#39;buffer_size&#39;: 0, &#39;input&#39;: &#39;-&#39;}, &#39;model&#39;: &#39;???&#39;, &#39;task&#39;: {&#39;_name&#39;: &#39;unpaired_audio_text&#39;, &#39;labels&#39;: &#39;phn&#39;, &#39;data&#39;: &#39;/content/precompute_pca512_cls128_mean&#39;, &#39;sort_by_length&#39;: False, &#39;shuffle&#39;: False, &#39;text_data&#39;: &#39;&#39;}, &#39;criterion&#39;: None, &#39;optimizer&#39;: None, &#39;lr_scheduler&#39;: None, &#39;scoring&#39;: None, &#39;bpe&#39;: None, &#39;tokenizer&#39;: None}, &#39;lm_weight&#39;: 2.0, &#39;w2l_decoder&#39;: &lt;DecoderType.VITERBI: 1&gt;, &#39;kaldi_decoder_config&#39;: None, &#39;lexicon&#39;: None, &#39;lm_model&#39;: None, &#39;unit_lm&#39;: False, &#39;beam_threshold&#39;: 50.0, &#39;beam_size_token&#39;: 100.0, &#39;beam&#39;: 5, &#39;nbest&#39;: 1, &#39;word_score&#39;: 1.0, &#39;unk_weight&#39;: -inf, &#39;sil_weight&#39;: 0.0, &#39;targets&#39;: None, &#39;results_path&#39;: &#39;/content/drive/MyDrive/w2vures&#39;, &#39;post_process&#39;: &#39;silence&#39;, &#39;vocab_usage_power&#39;: 2.0, &#39;viterbi_transcript&#39;: None, &#39;min_lm_ppl&#39;: 0.0, &#39;min_vt_uer&#39;: 0.0, &#39;blank_weight&#39;: 0.0, &#39;blank_mode&#39;: &#39;set&#39;, &#39;sil_is_blank&#39;: False, &#39;unsupervised_tuning&#39;: False, &#39;is_ax&#39;: False, &#39;job_logging_cfg&#39;: {&#39;version&#39;: 1, &#39;formatters&#39;: {&#39;simple&#39;: {&#39;format&#39;: &#39;[%(asctime)s][%(name)s][%(levelname)s] - %(message)s&#39;}}, &#39;handlers&#39;: {&#39;console&#39;: {&#39;class&#39;: &#39;logging.StreamHandler&#39;, &#39;formatter&#39;: &#39;simple&#39;, &#39;stream&#39;: &#39;ext://sys.stdout&#39;}, &#39;file&#39;: {&#39;class&#39;: &#39;logging.FileHandler&#39;, &#39;formatter&#39;: &#39;simple&#39;, &#39;filename&#39;: &#39;w2vu_generate.log&#39;}}, &#39;root&#39;: {&#39;level&#39;: &#39;INFO&#39;, &#39;handlers&#39;: [&#39;console&#39;, &#39;file&#39;]}, &#39;disable_existing_loggers&#39;: False}}
[2021-06-19 19:24:18,629][__main__][INFO] - | loading model(s) from /content/drive/MyDrive/w2vu/checkpoint_best.pt
[2021-06-19 19:24:22,829][unsupervised.data.extracted_features_dataset][INFO] - loaded 2019, skipped 0 samples
[2021-06-19 19:24:22,829][unsupervised.tasks.unpaired_audio_text][INFO] - split valid has unpaired text? False
[2021-06-19 19:24:22,833][__main__][INFO] - | /content/precompute_pca512_cls128_mean valid 2019 examples
[2021-06-19 19:24:41,807][__main__][INFO] - WER: 158.79173813943652
[2021-06-19 19:24:41,808][__main__][INFO] - | Processed 2019 sentences (80270 tokens) in 18.9s (106.61 sentences/s, 4238.35 tokens/s)
[2021-06-19 19:24:41,809][__main__][INFO] - | Generate valid with beam=5, lm_weight=2.0, word_score=1.0, sil_weight=0.0, blank_weight=0.0, WER: 158.79173813943652, LM_PPL: inf, num feats: 130753, length: 80270, UER to viterbi: 0, score: inf
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="jimregan/notes"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/notes/colab/wav2vec-u/2021/06/19/wav2vec-u-cv-swedish-w2vu-generate.html" hidden></a>
</article>