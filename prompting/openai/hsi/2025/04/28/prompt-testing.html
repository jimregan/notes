<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Prompt testing | notes</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Prompt testing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="With the OpenAI API" />
<meta property="og:description" content="With the OpenAI API" />
<link rel="canonical" href="https://jimregan.github.io/notes/prompting/openai/hsi/2025/04/28/prompt-testing.html" />
<meta property="og:url" content="https://jimregan.github.io/notes/prompting/openai/hsi/2025/04/28/prompt-testing.html" />
<meta property="og:site_name" content="notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-28T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://jimregan.github.io/notes/prompting/openai/hsi/2025/04/28/prompt-testing.html","@type":"BlogPosting","headline":"Prompt testing","dateModified":"2025-04-28T00:00:00-05:00","datePublished":"2025-04-28T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jimregan.github.io/notes/prompting/openai/hsi/2025/04/28/prompt-testing.html"},"description":"With the OpenAI API","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/notes/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://jimregan.github.io/notes/feed.xml" title="notes" /><link rel="shortcut icon" type="image/x-icon" href="/notes/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper">
    <a class="site-title" rel="author" href="/notes/">notes</a>
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon"></span>
        </label>

        <div class="nav-items">
  <a class="nav-item" href="/notes/about/">About Me</a>
  <a class="nav-item" href="/notes/search/">Search</a>
  <a class="nav-item" href="/notes/categories/">Tags</a>
</div>

      </nav>
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Prompt testing</h1><p class="page-description">With the OpenAI API</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2025-04-28T00:00:00-05:00" itemprop="datePublished">
        Apr 28, 2025
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      24 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/notes/categories/#prompting">prompting</a>
        &nbsp;
      
        <a class="category-tags-link" href="/notes/categories/#openai">openai</a>
        &nbsp;
      
        <a class="category-tags-link" href="/notes/categories/#hsi">hsi</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/jimregan/notes/tree/master/_notebooks/2025-04-28-prompt-testing.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/notes/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/jimregan/notes/master?filepath=_notebooks%2F2025-04-28-prompt-testing.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/notes/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/jimregan/notes/blob/master/_notebooks/2025-04-28-prompt-testing.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/notes/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2025-04-28-prompt-testing.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install openai
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">API_KEY</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">JSONPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/Users/joregan/Playing/hsi/annotations/final_resolved&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SKIPPABLES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;room&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">utt_key</span> <span class="o">=</span> <span class="s2">&quot;utterance_type&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">utt_key</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;high_level&quot;</span><span class="p">]:</span>
        <span class="n">utt_key</span> <span class="o">=</span> <span class="s2">&quot;topic_name&quot;</span>
    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;high_level&quot;</span><span class="p">][</span><span class="n">utt_key</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;conversation_generic&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;high_level&quot;</span><span class="p">][</span><span class="s2">&quot;current_topic&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">current</span> <span class="ow">in</span> <span class="n">SKIPPABLES</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">snippet</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;topic:&quot;</span><span class="p">:</span> <span class="n">current</span><span class="p">,</span>
        <span class="s2">&quot;snippet&quot;</span><span class="p">:</span> <span class="n">snippet</span>
    <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="n">alldata</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">filepointer</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">jsonfile</span> <span class="ow">in</span> <span class="n">JSONPATH</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.json&quot;</span><span class="p">):</span>
    <span class="n">stem</span> <span class="o">=</span> <span class="n">jsonfile</span><span class="o">.</span><span class="n">stem</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">room</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsonfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;person&quot;</span><span class="p">:</span> <span class="n">person</span><span class="p">,</span>
        <span class="s2">&quot;room&quot;</span><span class="p">:</span> <span class="n">room</span><span class="p">,</span>
        <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">processed</span> <span class="o">=</span> <span class="n">process_item</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">processed</span> <span class="ow">and</span> <span class="n">processed</span> <span class="o">!=</span> <span class="p">{}:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
    <span class="n">alldata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="n">filepointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stem</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/hsi.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">alldata</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">alldata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PROMPT</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Below is some data from a conversation. The data is in JSON format.</span>
<span class="s2">The data contains a list of items, each with a topic and a snippet. The topic is the subject of the conversation, and the snippet is a short excerpt from the conversation.</span>
<span class="s2">Continue the conversation by writing a new snippet that is relevant to the topic. The new snippet should contain a reference to the topic and should be a natural continuation of the conversation.</span>
<span class="s2">The new snippet should be in the same format as the original snippets, and should be a short paragraph of text, of between 30 and 80 words.</span>
<span class="s2">There should only be one reference to the topic in the new snippet. It should be a natural part of the conversation, and should not be forced or awkward. It should be marked in boldface using markdown syntax. Only the determiner should be marked; boldface is marked by a single asterisk. The reference should be to the item itself, not to an abstract property related to the item: for example, in &quot;the style of that painting&quot;, only &quot;that painting&quot; is a valid reference to the item: &quot;the style&quot; is not a valid reference to the item.</span>
<span class="s2">The reference to the topic should be suitable for instructing a person to point at it in a conversation. It can be a noun phrase, or a pronoun, but it should be clear and unambiguous. If the reference is a noun phrase, it should include a determiner, such as &quot;this&quot; or &quot;that&quot;. Do not count articles (&quot;the&quot;, &quot;a&quot;, &quot;an&quot;) as determiners, we are only interested in demonstrative determiners. If the reference is a pronoun, it should be clear what it refers to. Be sure to vary the references so there are results with each type of reference.</span>
<span class="s2">If another topic is mentioned in the new snippet and the spatial relationship is very clear, it is ok to reuse that spatial reference.</span>
<span class="s2">&#39;If you want, I can stop by the kiosk and get *a newspaper* for tomorrow.&#39; is a bad example for a snippet, because it does not contain to the item itself, but to another item of that category; also it includes an article &quot;a&quot; instead of a demonstrative determiner.</span>
<span class="s2">Create as many new snippets as there are items in the data.</span>
<span class="s2">```json</span>
<span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2"></span>
<span class="s2">```</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">PROMPT</span> <span class="p">},</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ChatCompletion(id=&#39;chatcmpl-BRGKBf83FizBn2cuY40CfosbbuwGm&#39;, choices=[Choice(finish_reason=&#39;stop&#39;, index=0, logprobs=None, message=ChatCompletionMessage(content=&#39;```json\n{\&#39;topic:\&#39;: \&#39;Book_28\&#39;, \&#39;snippet\&#39;: &#34;Yeah, I noticed **that novel** when I came in, and it seemed interesting. It must belong to someone who really enjoys detective stories, don\&#39;t you think?&#34;}\n```&#39;, refusal=None, role=&#39;assistant&#39;, annotations=[], audio=None, function_call=None, tool_calls=None))], created=1745837307, model=&#39;gpt-4o-2024-08-06&#39;, object=&#39;chat.completion&#39;, service_tier=&#39;default&#39;, system_fingerprint=&#39;fp_90122d973c&#39;, usage=CompletionUsage(completion_tokens=52, prompt_tokens=1029, total_tokens=1081, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response_text</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;```json\n{\&#39;topic:\&#39;: \&#39;Book_28\&#39;, \&#39;snippet\&#39;: &#34;Yeah, I noticed **that novel** when I came in, and it seemed interesting. It must belong to someone who really enjoys detective stories, don\&#39;t you think?&#34;}\n```&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">clean_response</span><span class="p">(</span><span class="n">response_text</span><span class="p">):</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;```json&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">response_text</span> <span class="o">=</span> <span class="n">response_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="c1"># response_text = response_text.replace(&quot;&#39;&quot;, &#39;&quot;&#39;)</span>
    <span class="c1"># try:</span>
    <span class="c1">#     return json.loads(response_text)</span>
    <span class="c1"># except json.JSONDecodeError:</span>
    <span class="c1">#     print(response_text)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_response</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;topic:&#39;: &#39;Book_28&#39;,
 &#39;snippet&#39;: &#34;Yeah, I noticed **that novel** when I came in, and it seemed interesting. It must belong to someone who really enjoys detective stories, don&#39;t you think?&#34;}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">PROMPT</span> <span class="p">},</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ChatCompletion(id=&#39;chatcmpl-BRGSLwcAubUqXJVqMYgh5T77PwpTP&#39;, choices=[Choice(finish_reason=&#39;stop&#39;, index=0, logprobs=None, message=ChatCompletionMessage(content=&#39;```json\n[\n    {&#34;topic:&#34;: &#34;furniture&#34;, &#34;snippet&#34;: &#34;I\&#39;ll rearrange the chairs today, so **this setup** feels more welcoming.&#34;},\n    {&#34;topic:&#34;: &#34;furniture&#34;, &#34;snippet&#34;: &#34;Perhaps moving **that table** near the window would brighten up the room.&#34;},\n    {&#34;topic:&#34;: &#34;furniture&#34;, &#34;snippet&#34;: &#34;You know, **those stools** would be perfect at the kitchen counter.&#34;},\n    {&#34;topic:&#34;: &#34;furniture&#34;, &#34;snippet&#34;: &#34;Let\&#39;s think about where **this bench** could go; maybe the hallway?&#34;},\n    {&#34;topic:&#34;: &#34;Television_f9d000b1&#34;, &#34;snippet&#34;: &#34;Maybe we could move **the TV** to the opposite wall for a cozier setup.&#34;},\n    {&#34;topic:&#34;: &#34;Dog_Statue_1&#34;, &#34;snippet&#34;: &#34;I checked around, and **the statue** seems perfectly fine now.&#34;},\n    {&#34;topic:&#34;: &#34;Dog_Statue_1&#34;, &#34;snippet&#34;: &#34;I\&#39;d love to know how **that piece** first caught your eye.&#34;},\n    {&#34;topic:&#34;: &#34;Dog_Statue_1&#34;, &#34;snippet&#34;: &#34;And I was thinking, maybe **this statue** deserves a spot in the garden.&#34;},\n    {&#34;topic:&#34;: &#34;Tennis_Racquet_4&#34;, &#34;snippet&#34;: &#34;I think **this racquet** needs a new grip before the next match.&#34;},\n    {&#34;topic:&#34;: &#34;Laptop_4&#34;, &#34;snippet&#34;: &#34;I found **the charger**, so now you can use it wherever you like.&#34;},\n    {&#34;topic:&#34;: &#34;Laptop_4&#34;, &#34;snippet&#34;: &#34;Sure, just let me know if **this laptop** starts acting up again.&#34;},\n    {&#34;topic:&#34;: &#34;Laptop_4&#34;, &#34;snippet&#34;: &#34;I\&#39;m happy holding onto **this one** until you\&#39;re sure you need it.&#34;},\n    {&#34;topic:&#34;: &#34;KeyChain_76c05fe6&#34;, &#34;snippet&#34;: &#34;Can you show me how **these keys** fit into everything?&#34;},\n    {&#34;topic:&#34;: &#34;Newspaper_990192bf&#34;, &#34;snippet&#34;: &#34;If you want, we could swap **this newspaper** for a new one.&#34;},\n    {&#34;topic:&#34;: &#34;Newspaper_990192bf&#34;, &#34;snippet&#34;: &#34;I heard they changed the layout in **the papers**, right?&#34;},\n    {&#34;topic:&#34;: &#34;Newspaper_990192bf&#34;, &#34;snippet&#34;: &#34;I\&#39;ve been thinking of subscribing to **them** for a while now.&#34;},\n    {&#34;topic:&#34;: &#34;Box_7d6b3e2c&#34;, &#34;snippet&#34;: &#34;I wonder if **that box** has any old photos we can look through.&#34;},\n    {&#34;topic:&#34;: &#34;Book_17&#34;, &#34;snippet&#34;: &#34;I might borrow **this novel** once you\&#39;re done with it.&#34;},\n    {&#34;topic:&#34;: &#34;Book_17&#34;, &#34;snippet&#34;: &#34;Noticed that **another book** fits well with the decor too.&#34;},\n    {&#34;topic:&#34;: &#34;Book_17&#34;, &#34;snippet&#34;: &#34;I can’t wait to hear your thoughts on **the story** when you finish.&#34;},\n    {&#34;topic:&#34;: &#34;furniture&#34;, &#34;snippet&#34;: &#34;After settling **this room**, moving the furniture outside may be next.&#34;},\n    {&#34;topic:&#34;: &#34;painting&#34;, &#34;snippet&#34;: &#34;I think that moving **these paintings** has changed the room\&#39;s atmosphere.&#34;},\n    {&#34;topic:&#34;: &#34;painting&#34;, &#34;snippet&#34;: &#34;And if we frame **that piece**, the entire collection will truly shine.&#34;},\n    {&#34;topic:&#34;: &#34;garbage bin&#34;, &#34;snippet&#34;: &#34;It might be a good idea to move **the bin** outside, near the sidewalk.&#34;},\n    {&#34;topic:&#34;: &#34;Book_28&#34;, &#34;snippet&#34;: &#34;Or perhaps **that novel** could be a fun read during the weekend.&#34;}\n]\n```&#39;, refusal=None, role=&#39;assistant&#39;, annotations=[], audio=None, function_call=None, tool_calls=None))], created=1745837813, model=&#39;gpt-4o-2024-08-06&#39;, object=&#39;chat.completion&#39;, service_tier=&#39;default&#39;, system_fingerprint=&#39;fp_90122d973c&#39;, usage=CompletionUsage(completion_tokens=792, prompt_tokens=1060, total_tokens=1852, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_response</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#34;I&#39;ll rearrange the chairs today, so **this setup** feels more welcoming.&#34;},
 {&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#39;Perhaps moving **that table** near the window would brighten up the room.&#39;},
 {&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#39;You know, **those stools** would be perfect at the kitchen counter.&#39;},
 {&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#34;Let&#39;s think about where **this bench** could go; maybe the hallway?&#34;},
 {&#39;topic:&#39;: &#39;Television_f9d000b1&#39;,
  &#39;snippet&#39;: &#39;Maybe we could move **the TV** to the opposite wall for a cozier setup.&#39;},
 {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
  &#39;snippet&#39;: &#39;I checked around, and **the statue** seems perfectly fine now.&#39;},
 {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
  &#39;snippet&#39;: &#34;I&#39;d love to know how **that piece** first caught your eye.&#34;},
 {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
  &#39;snippet&#39;: &#39;And I was thinking, maybe **this statue** deserves a spot in the garden.&#39;},
 {&#39;topic:&#39;: &#39;Tennis_Racquet_4&#39;,
  &#39;snippet&#39;: &#39;I think **this racquet** needs a new grip before the next match.&#39;},
 {&#39;topic:&#39;: &#39;Laptop_4&#39;,
  &#39;snippet&#39;: &#39;I found **the charger**, so now you can use it wherever you like.&#39;},
 {&#39;topic:&#39;: &#39;Laptop_4&#39;,
  &#39;snippet&#39;: &#39;Sure, just let me know if **this laptop** starts acting up again.&#39;},
 {&#39;topic:&#39;: &#39;Laptop_4&#39;,
  &#39;snippet&#39;: &#34;I&#39;m happy holding onto **this one** until you&#39;re sure you need it.&#34;},
 {&#39;topic:&#39;: &#39;KeyChain_76c05fe6&#39;,
  &#39;snippet&#39;: &#39;Can you show me how **these keys** fit into everything?&#39;},
 {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
  &#39;snippet&#39;: &#39;If you want, we could swap **this newspaper** for a new one.&#39;},
 {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
  &#39;snippet&#39;: &#39;I heard they changed the layout in **the papers**, right?&#39;},
 {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
  &#39;snippet&#39;: &#34;I&#39;ve been thinking of subscribing to **them** for a while now.&#34;},
 {&#39;topic:&#39;: &#39;Box_7d6b3e2c&#39;,
  &#39;snippet&#39;: &#39;I wonder if **that box** has any old photos we can look through.&#39;},
 {&#39;topic:&#39;: &#39;Book_17&#39;,
  &#39;snippet&#39;: &#34;I might borrow **this novel** once you&#39;re done with it.&#34;},
 {&#39;topic:&#39;: &#39;Book_17&#39;,
  &#39;snippet&#39;: &#39;Noticed that **another book** fits well with the decor too.&#39;},
 {&#39;topic:&#39;: &#39;Book_17&#39;,
  &#39;snippet&#39;: &#39;I can’t wait to hear your thoughts on **the story** when you finish.&#39;},
 {&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#39;After settling **this room**, moving the furniture outside may be next.&#39;},
 {&#39;topic:&#39;: &#39;painting&#39;,
  &#39;snippet&#39;: &#34;I think that moving **these paintings** has changed the room&#39;s atmosphere.&#34;},
 {&#39;topic:&#39;: &#39;painting&#39;,
  &#39;snippet&#39;: &#39;And if we frame **that piece**, the entire collection will truly shine.&#39;},
 {&#39;topic:&#39;: &#39;garbage bin&#39;,
  &#39;snippet&#39;: &#39;It might be a good idea to move **the bin** outside, near the sidewalk.&#39;},
 {&#39;topic:&#39;: &#39;Book_28&#39;,
  &#39;snippet&#39;: &#39;Or perhaps **that novel** could be a fun read during the weekend.&#39;}]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">esponse</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">PROMPT</span> <span class="p">},</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">esponse</span>
<span class="n">esponse_text</span> <span class="o">=</span> <span class="n">esponse</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_response</span><span class="p">(</span><span class="n">esponse_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;person&#39;: &#39;4&#39;,
 &#39;room&#39;: &#39;222&#39;,
 &#39;items&#39;: [{&#39;topic&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#39;We can try rearranging *the* furniture into a more open layout, which might make the room feel bigger.&#39;},
  {&#39;topic&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#39;Maybe moving *that* couch closer to the window will make the room more inviting.&#39;},
  {&#39;topic&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#34;Let&#39;s keep *that* chair near the entrance as it seems to welcome guests quite nicely.&#34;},
  {&#39;topic&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#39;Sure, I can help you with rearranging *the* furniture now so everything is ready for when guests arrive.&#39;},
  {&#39;topic&#39;: &#39;Television_f9d000b1&#39;,
   &#39;snippet&#39;: &#39;Well, *the* TV is mostly just background noise; I prefer engaging conversations with friends.&#39;},
  {&#39;topic&#39;: &#39;Dog_Statue_1&#39;,
   &#39;snippet&#39;: &#39;Oh, *the* dog statue is just missing a small piece, but it still looks great.&#39;},
  {&#39;topic&#39;: &#39;Dog_Statue_1&#39;,
   &#39;snippet&#39;: &#39;I think *that* dog statue can be repaired easily; we should look into it.&#39;},
  {&#39;topic&#39;: &#39;Dog_Statue_1&#39;,
   &#39;snippet&#39;: &#34;Interestingly, *the* green one seems to be everyone&#39;s favorite, don&#39;t you think?&#34;},
  {&#39;topic&#39;: &#39;Tennis_Racquet_4&#39;,
   &#39;snippet&#39;: &#39;We should place *the* racket back in its bag so it doesn’t get damaged.&#39;},
  {&#39;topic&#39;: &#39;Laptop_4&#39;,
   &#39;snippet&#39;: &#34;*The* computer has such a sleek design; it&#39;s definitely a great choice for work.&#34;},
  {&#39;topic&#39;: &#39;Laptop_4&#39;,
   &#39;snippet&#39;: &#34;If you&#39;re unsure about *that* laptop, maybe it belongs to someone else around here.&#34;},
  {&#39;topic&#39;: &#39;Laptop_4&#39;,
   &#39;snippet&#39;: &#34;Once you&#39;re sure it&#39;s safely packed, I&#39;ll help you put *the* laptop away.&#34;},
  {&#39;topic&#39;: &#39;KeyChain_76c05fe6&#39;,
   &#39;snippet&#39;: &#39;*The* keys always seem to get misplaced; we need a dedicated spot for them.&#39;},
  {&#39;topic&#39;: &#39;Newspaper_990192bf&#39;,
   &#39;snippet&#39;: &#39;I think picking up *that* newspaper could be a part of a nice morning ritual.&#39;},
  {&#39;topic&#39;: &#39;Newspaper_990192bf&#39;,
   &#39;snippet&#39;: &#34;Actually, I don&#39;t get *them* anymore, but I miss having a casual read now and then.&#34;},
  {&#39;topic&#39;: &#39;Newspaper_990192bf&#39;,
   &#39;snippet&#39;: &#34;I&#39;ll check if I can get a subscription service for *the* newspaper to be delivered.&#34;},
  {&#39;topic&#39;: &#39;Box_7d6b3e2c&#39;,
   &#39;snippet&#39;: &#39;Looks like *the* old box could be full of memories; do you want to open it together?&#39;},
  {&#39;topic&#39;: &#39;Book_17&#39;,
   &#39;snippet&#39;: &#39;And *this* thick book seems to be quite the engaging read; how are you finding it?&#39;},
  {&#39;topic&#39;: &#39;Book_17&#39;,
   &#39;snippet&#39;: &#34;Seeing how *this* book complements the aesthetic, I&#39;m glad you liked it.&#34;},
  {&#39;topic&#39;: &#39;Book_17&#39;,
   &#39;snippet&#39;: &#39;Even with *the* book here, the whole setting feels so harmonious and cozy.&#39;},
  {&#39;topic&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#34;Before arranging *the* furniture back, let&#39;s see if these pillows can add some charm.&#34;},
  {&#39;topic&#39;: &#39;painting&#39;,
   &#39;snippet&#39;: &#34;*The* painting gives off such a timeless vibe; I&#39;m glad you chose this spot.&#34;},
  {&#39;topic&#39;: &#39;painting&#39;,
   &#39;snippet&#39;: &#34;Finding a suitable place for *the* old paintings really enhances the room&#39;s character.&#34;},
  {&#39;topic&#39;: &#39;garbage bin&#39;,
   &#39;snippet&#39;: &#34;Let&#39;s move *the* garbage bin a bit further from the door to keep the living room tidy.&#34;},
  {&#39;topic&#39;: &#39;Book_28&#39;,
   &#39;snippet&#39;: &#34;You know, *this* Sherlock Holmes book looks intriguing; maybe it&#39;s worth a little peek.&#34;}]}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">PROMPT</span> <span class="p">},</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ChatCompletion(id=&#39;chatcmpl-BRGlWs58wDnCeyaEyxswix4IoJmmS&#39;, choices=[Choice(finish_reason=&#39;stop&#39;, index=0, logprobs=None, message=ChatCompletionMessage(content=&#39;```json\n[\n    {\n        &#34;topic&#34;: &#34;furniture&#34;,\n        &#34;snippet&#34;: &#34;Let\&#39;s rearrange the layout again. I think moving **this table** closer to the window might brighten up the space.&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;Television_f9d000b1&#34;,\n        &#34;snippet&#34;: &#34;Speaking of TV, can we at least turn **it** on for some background noise while we chat?&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;Dog_Statue_1&#34;,\n        &#34;snippet&#34;: &#34;I\&#39;m curious to know how **this statue** ended up here in the first place. It\&#39;s quite a conversation piece!&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;Tennis_Racquet_4&#34;,\n        &#34;snippet&#34;: &#34;Oh, and I think **that racket** might come in handy if anyone wants to play later.&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;Laptop_4&#34;,\n        &#34;snippet&#34;: &#34;By the way, I was wondering if **this laptop** has enough storage for my project files.&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;KeyChain_76c05fe6&#34;,\n        &#34;snippet&#34;: &#34;I think **this keychain** would be easier to spot if we hung it by the door.&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;Newspaper_990192bf&#34;,\n        &#34;snippet&#34;: &#34;Could you pass **that newspaper** over? I want to clip out the Sunday puzzle section.&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;Box_7d6b3e2c&#34;,\n        &#34;snippet&#34;: &#34;The contents of **this old box** must hold a lot of history! Do you ever dig through it?&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;Book_17&#34;,\n        &#34;snippet&#34;: &#34;I heard someone describe **this book** as a masterpiece. Have you gotten to any of the good parts yet?&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;painting&#34;,\n        &#34;snippet&#34;: &#34;If you get closer, you\&#39;ll see **this painting** has incredible details that you can\&#39;t miss.&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;garbage bin&#34;,\n        &#34;snippet&#34;: &#34;We should move **that garbage bin** out to the kitchen, so it doesn\&#39;t clutter the space here.&#34;\n    },\n    {\n        &#34;topic&#34;: &#34;Book_28&#34;,\n        &#34;snippet&#34;: &#34;Well, if you\&#39;re done with **that Sherlock Holmes book**, I\&#39;d love to borrow it for the flight.&#34;\n    }\n]\n```&#39;, refusal=None, role=&#39;assistant&#39;, annotations=[], audio=None, function_call=None, tool_calls=None))], created=1745839002, model=&#39;gpt-4o-2024-08-06&#39;, object=&#39;chat.completion&#39;, service_tier=&#39;default&#39;, system_fingerprint=&#39;fp_90122d973c&#39;, usage=CompletionUsage(completion_tokens=500, prompt_tokens=1221, total_tokens=1721, completion_tokens_details=CompletionTokensDetails(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0), prompt_tokens_details=PromptTokensDetails(audio_tokens=0, cached_tokens=0)))</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_response</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#34;Every time I walk in here, it&#39;s like a whole new space! Can you remind me why you wanted to move *this furniture* all the way to the other side?&#34;},
 {&#39;topic:&#39;: &#39;Television_f9d000b1&#39;,
  &#39;snippet&#39;: &#39;I understand, but did you catch what happened with *that TV* last week? I heard there was some issue with the signal.&#39;},
 {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
  &#39;snippet&#39;: &#34;I hope *that dog statue* isn&#39;t too fragile, especially considering how easily things get knocked over in here.&#34;},
 {&#39;topic:&#39;: &#39;Tennis_Racquet_4&#39;,
  &#39;snippet&#39;: &#34;Maybe after we&#39;re done, we can go out and hit a few balls with *this racket*. It&#39;s been a while since I&#39;ve played tennis.&#34;},
 {&#39;topic:&#39;: &#39;Laptop_4&#39;,
  &#39;snippet&#39;: &#34;Even though this looks like my old one, I&#39;m sure *that laptop* belongs to you. Maybe we can check the files to confirm?&#34;},
 {&#39;topic:&#39;: &#39;KeyChain_76c05fe6&#39;,
  &#39;snippet&#39;: &#39;You must have a lot of responsibilities with all those keys. I wonder if *that keychain* has any special meaning to you.&#39;},
 {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
  &#39;snippet&#39;: &#34;I&#39;m thinking of subscribing again. Does *that newspaper* have any interesting articles today?&#34;},
 {&#39;topic:&#39;: &#39;Box_7d6b3e2c&#39;,
  &#39;snippet&#39;: &#34;Looks like *this box* has been here forever. Maybe we should peek inside and see if there&#39;s anything worth keeping.&#34;},
 {&#39;topic:&#39;: &#39;Book_17&#39;,
  &#39;snippet&#39;: &#34;I actually started reading something similar. If you&#39;re done, I&#39;d love to borrow *that book* sometime.&#34;},
 {&#39;topic:&#39;: &#39;painting&#39;,
  &#39;snippet&#39;: &#34;I&#39;m glad *this painting* is still up—it really ties the room together. Did you notice how it complements the lighting?&#34;},
 {&#39;topic:&#39;: &#39;garbage bin&#39;,
  &#39;snippet&#39;: &#34;You&#39;re right; we should move *that garbage bin* somewhere it won’t be in the way, maybe closer to the kitchen.&#34;},
 {&#39;topic:&#39;: &#39;Book_28&#39;,
  &#39;snippet&#39;: &#34;Even if it&#39;s not yours, *this book* really adds character to the shelf. Maybe we should leave it out for guests to peruse.&#34;}]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_response</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;person&#39;: &#39;4&#39;,
 &#39;room&#39;: &#39;222&#39;,
 &#39;items&#39;: [{&#39;topic:&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#34;The new setup actually makes *this room* feel more spacious, don&#39;t you think?&#34;},
  {&#39;topic:&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#34;I can&#39;t quite remember, but wasn&#39;t *that couch* part of a set? It looks distinct on its own now.&#34;},
  {&#39;topic:&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#34;Could we move everything next weekend? I&#39;d like to try a different layout for *the sofas* this time.&#34;},
  {&#39;topic:&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#34;Let&#39;s make sure we don&#39;t forget the coasters when we adjust *those tables* around.&#34;},
  {&#39;topic:&#39;: &#39;Television_f9d000b1&#39;,
   &#39;snippet&#39;: &#34;Maybe when we&#39;re done chatting, we can catch a new show on *that TV* together.&#34;},
  {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
   &#39;snippet&#39;: &#39;Actually, *this dog statue* looks pretty charming. It adds character to the room.&#39;},
  {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
   &#39;snippet&#39;: &#34;I heard you fixed it, so how&#39;s *the statue* holding up now?&#34;},
  {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
   &#39;snippet&#39;: &#39;*This statue* looks quite regal on the mantelpiece. The green makes it pop!&#39;},
  {&#39;topic:&#39;: &#39;Tennis_Racquet_4&#39;,
   &#39;snippet&#39;: &#39;Did you know the owner of *the tennis racquet*? It seems well-used.&#39;},
  {&#39;topic:&#39;: &#39;Laptop_4&#39;,
   &#39;snippet&#39;: &#34;Could you help me with something on *this laptop*? I&#39;m having trouble logging in.&#34;},
  {&#39;topic:&#39;: &#39;Laptop_4&#39;,
   &#39;snippet&#39;: &#39;We could use *the laptop* to play some music while we reorganize this room.&#39;},
  {&#39;topic:&#39;: &#39;Laptop_4&#39;,
   &#39;snippet&#39;: &#39;Are you sure you want to give it away? *That laptop* seems like a reliable companion.&#39;},
  {&#39;topic:&#39;: &#39;KeyChain_76c05fe6&#39;,
   &#39;snippet&#39;: &#34;Ah, I see you&#39;re using *this keychain* now. A practical and stylish choice.&#34;},
  {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
   &#39;snippet&#39;: &#39;I think you left *the newspaper* on the table, just by the window.&#39;},
  {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
   &#39;snippet&#39;: &#39;*This one* is packed with good articles; quite informative.&#39;},
  {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
   &#39;snippet&#39;: &#39;If you want, I can stop by the kiosk and get *a newspaper* for tomorrow.&#39;},
  {&#39;topic:&#39;: &#39;Box_7d6b3e2c&#39;,
   &#39;snippet&#39;: &#34;Looks like you&#39;ve been using *this box* for storage. Anything interesting inside?&#34;},
  {&#39;topic:&#39;: &#39;Book_17&#39;,
   &#39;snippet&#39;: &#39;Have you finished reading *this thick book* yet? It seems like a serious read.&#39;},
  {&#39;topic:&#39;: &#39;Book_17&#39;,
   &#39;snippet&#39;: &#39;*The cover of this book* is so visually appealing; it caught my eye immediately.&#39;},
  {&#39;topic:&#39;: &#39;Book_17&#39;,
   &#39;snippet&#39;: &#39;The colors of *the book* and the rug seem to go well together, don’t they?&#39;},
  {&#39;topic:&#39;: &#39;furniture&#39;,
   &#39;snippet&#39;: &#34;With *this furniture* rearrangement, the sunlight hits differently, enhancing the room&#39;s ambiance.&#34;},
  {&#39;topic:&#39;: &#39;painting&#39;,
   &#39;snippet&#39;: &#39;Did I mention how *this painting* perfectly complements the color scheme here?&#39;},
  {&#39;topic:&#39;: &#39;painting&#39;,
   &#39;snippet&#39;: &#34;I can&#39;t believe we found another classic to match *the old painting*. It’s simply remarkable.&#34;},
  {&#39;topic:&#39;: &#39;garbage bin&#39;,
   &#39;snippet&#39;: &#39;How about moving *the garbage bin* to the pantry to keep the living room uncluttered?&#39;},
  {&#39;topic:&#39;: &#39;Book_28&#39;,
   &#39;snippet&#39;: &#39;*This Sherlock Holmes book* must belong to someone else, given your taste in literature.&#39;}]}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_response</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;topic&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#34;Let&#39;s rearrange the layout again. I think moving **this table** closer to the window might brighten up the space.&#34;},
 {&#39;topic&#39;: &#39;Television_f9d000b1&#39;,
  &#39;snippet&#39;: &#39;Speaking of TV, can we at least turn **it** on for some background noise while we chat?&#39;},
 {&#39;topic&#39;: &#39;Dog_Statue_1&#39;,
  &#39;snippet&#39;: &#34;I&#39;m curious to know how **this statue** ended up here in the first place. It&#39;s quite a conversation piece!&#34;},
 {&#39;topic&#39;: &#39;Tennis_Racquet_4&#39;,
  &#39;snippet&#39;: &#39;Oh, and I think **that racket** might come in handy if anyone wants to play later.&#39;},
 {&#39;topic&#39;: &#39;Laptop_4&#39;,
  &#39;snippet&#39;: &#39;By the way, I was wondering if **this laptop** has enough storage for my project files.&#39;},
 {&#39;topic&#39;: &#39;KeyChain_76c05fe6&#39;,
  &#39;snippet&#39;: &#39;I think **this keychain** would be easier to spot if we hung it by the door.&#39;},
 {&#39;topic&#39;: &#39;Newspaper_990192bf&#39;,
  &#39;snippet&#39;: &#39;Could you pass **that newspaper** over? I want to clip out the Sunday puzzle section.&#39;},
 {&#39;topic&#39;: &#39;Box_7d6b3e2c&#39;,
  &#39;snippet&#39;: &#39;The contents of **this old box** must hold a lot of history! Do you ever dig through it?&#39;},
 {&#39;topic&#39;: &#39;Book_17&#39;,
  &#39;snippet&#39;: &#39;I heard someone describe **this book** as a masterpiece. Have you gotten to any of the good parts yet?&#39;},
 {&#39;topic&#39;: &#39;painting&#39;,
  &#39;snippet&#39;: &#34;If you get closer, you&#39;ll see **this painting** has incredible details that you can&#39;t miss.&#34;},
 {&#39;topic&#39;: &#39;garbage bin&#39;,
  &#39;snippet&#39;: &#34;We should move **that garbage bin** out to the kitchen, so it doesn&#39;t clutter the space here.&#34;},
 {&#39;topic&#39;: &#39;Book_28&#39;,
  &#39;snippet&#39;: &#34;Well, if you&#39;re done with **that Sherlock Holmes book**, I&#39;d love to borrow it for the flight.&#34;}]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PROMPT</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are given a JSON list of conversation items. Each item has a &quot;topic&quot; and a &quot;snippet&quot; (a short excerpt).</span>

<span class="s2">Your task is to write a **new snippet** for each topic:</span>
<span class="s2">- The new snippet must naturally continue the conversation and be **30–80 words** long.</span>
<span class="s2">- It must include exactly **one reference** to the **specific topic**, using a demonstrative determiner (&quot;this&quot;, &quot;that&quot;, &quot;these&quot;, &quot;those&quot;) or a clear pronoun.</span>
<span class="s2">- **Only** the determiner should be marked in bold using markdown (e.g., *this painting*).</span>
<span class="s2">- Do not refer to a general category (e.g., &quot;a newspaper&quot;); refer directly to the topic.</span>
<span class="s2">- References must sound natural, not forced. Vary between noun phrases and pronouns where possible.</span>
<span class="s2">- If another topic is clearly mentioned in relation to the main one, it’s acceptable to reuse spatial references.</span>
<span class="s2">- Create **one new snippet per item**.</span>

<span class="s2">Bad example:  </span>
<span class="s2">&#39;If you want, I can stop by the kiosk and get *a newspaper* for tomorrow.&#39; → Incorrect: refers to another item, uses an article instead of a demonstrative determiner.</span>

<span class="s2">---</span>

<span class="s2">```json</span>
<span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2"></span>
<span class="s2">```</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">esponse</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">PROMPT</span> <span class="p">},</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">esponse_text</span> <span class="o">=</span> <span class="n">esponse</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_response</span><span class="p">(</span><span class="n">esponse_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#34;Can you rearrange *these pieces* a bit more toward the window? It might make the room feel more open and enhance the overall look. Otherwise, it seems a bit crowded in here, and we can&#39;t fully appreciate the space.&#34;},
 {&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#34;I see what you mean. *This couch* would look much better by the window, creating a cozy nook. How about rearranging it next weekend together? It&#39;ll give us a fresh perspective.&#34;},
 {&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#39;You know, by moving *those sofas* around, we might find the perfect setup for comfortable conversations. It’s worth experimenting until we get it just right.&#39;},
 {&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#34;I&#39;d appreciate your help to shift *them* around. With your eye for detail and my muscle, we can transform the whole setting into something more inviting.&#34;},
 {&#39;topic:&#39;: &#39;Television_f9d000b1&#39;,
  &#39;snippet&#39;: &#39;I totally agree. Sometimes just sitting and chatting is far more fulfilling than any show we could watch on *this TV*.&#39;},
 {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
  &#39;snippet&#39;: &#34;Hopefully, we can fix *that statue* soon. It adds such a unique touch to the room, and it&#39;d be a shame to leave it in disrepair.&#34;},
 {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
  &#39;snippet&#39;: &#34;Oh no! I hope *it&#39;s* not too damaged. It was such a charming piece in the corner with its vibrant color.&#34;},
 {&#39;topic:&#39;: &#39;Dog_Statue_1&#39;,
  &#39;snippet&#39;: &#34;That&#39;s good to hear. I always thought the subtle green hue on *that statue* was a wonderful addition to the decor.&#34;},
 {&#39;topic:&#39;: &#39;Tennis_Racquet_4&#39;,
  &#39;snippet&#39;: &#39;It seems like *this racket* is in the way. Maybe we should find a dedicated spot for it, perhaps in the sports corner of the room.&#39;},
 {&#39;topic:&#39;: &#39;Laptop_4&#39;,
  &#39;snippet&#39;: &#34;If you&#39;re unsure, we can check the label to see if *this laptop* belongs to you. It&#39;s better to confirm before we take any further steps.&#34;},
 {&#39;topic:&#39;: &#39;Laptop_4&#39;,
  &#39;snippet&#39;: &#34;Indeed, *that&#39;s* possible, but if it is, you might find some of your old files on it, which could clarify things.&#34;},
 {&#39;topic:&#39;: &#39;Laptop_4&#39;,
  &#39;snippet&#39;: &#34;If you’re positive it&#39;s not yours, *it* may serve as a useful backup. It’s always good to have a secondary device around.&#34;},
 {&#39;topic:&#39;: &#39;KeyChain_76c05fe6&#39;,
  &#39;snippet&#39;: &#34;Ah yes, *this keychain* might help keep everything organized and in one place. With so many keys, it&#39;s easy to misplace one.&#34;},
 {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
  &#39;snippet&#39;: &#34;I wonder if you&#39;d like to discuss any interesting articles from *this newspaper*. It&#39;s always fun to share insights.&#34;},
 {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
  &#39;snippet&#39;: &#39;If you enjoy *them*, maybe you can consider a subscription. It can be quite convenient to have them directly delivered to your door.&#39;},
 {&#39;topic:&#39;: &#39;Newspaper_990192bf&#39;,
  &#39;snippet&#39;: &#39;Luckily, you can pay digitally. *This subscription* can be renewed quickly online, saving you any hassle.&#39;},
 {&#39;topic:&#39;: &#39;Box_7d6b3e2c&#39;,
  &#39;snippet&#39;: &#39;We should decide where *this box* belongs. Is it storage, or do you have plans to sort through it soon?&#39;},
 {&#39;topic:&#39;: &#39;Book_17&#39;,
  &#39;snippet&#39;: &#34;I&#39;m curious whether *this hardcover* is a page-turner for you. If so, I&#39;d love some recommendations from it.&#34;},
 {&#39;topic:&#39;: &#39;Book_17&#39;,
  &#39;snippet&#39;: &#39;Appreciate it! You know, I think *it* adds a scholarly charm to the room, complementing the overall aesthetic beautifully.&#39;},
 {&#39;topic:&#39;: &#39;Book_17&#39;,
  &#39;snippet&#39;: &#34;It&#39;s amazing how well *this edition* fits into the room&#39;s design. It brings a sense of sophistication to the space.&#34;},
 {&#39;topic:&#39;: &#39;furniture&#39;,
  &#39;snippet&#39;: &#39;Before we finish up, let’s make sure *these cushions* are neatly arranged. They bring a lot of warmth to the room when positioned correctly.&#39;},
 {&#39;topic:&#39;: &#39;painting&#39;,
  &#39;snippet&#39;: &#34;Rearranging *these artworks* might give a fresh outlook. I&#39;m curious to see how the room would feel with the new placements.&#34;},
 {&#39;topic:&#39;: &#39;painting&#39;,
  &#39;snippet&#39;: &#34;I adore how prominently *it* stands out. It&#39;s nice to see a piece of art immediately establish a room&#39;s character.&#34;},
 {&#39;topic:&#39;: &#39;garbage bin&#39;,
  &#39;snippet&#39;: &#39;I agree, *this garbage bin* needs a new spot. Perhaps moving it closer to the kitchen would be more convenient.&#39;},
 {&#39;topic:&#39;: &#39;Book_28&#39;,
  &#39;snippet&#39;: &#34;If you&#39;re not into this genre, maybe *this mystery novel* isn&#39;t your style, but it could be a nice gift for someone else who enjoys detective stories.&#34;}]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_prompt</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are given a JSON list of conversation items. Each item has a &quot;topic&quot; and a &quot;snippet&quot; (a short excerpt).</span>

<span class="s2">Your task is to write a **new snippet** for each topic:</span>
<span class="s2">- The new snippet must naturally continue the conversation and be **30–80 words** long.</span>
<span class="s2">- It must include exactly **one reference** to the **specific topic**, using a demonstrative determiner (&quot;this&quot;, &quot;that&quot;, &quot;these&quot;, &quot;those&quot;) or a clear pronoun.</span>
<span class="s2">- **Only** the determiner should be marked in bold using markdown (e.g., *this painting*).</span>
<span class="s2">- Do not refer to a general category (e.g., &quot;a newspaper&quot;); refer directly to the topic.</span>
<span class="s2">- References must sound natural, not forced. Vary between noun phrases and pronouns where possible.</span>
<span class="s2">- If another topic is clearly mentioned in relation to the main one, it’s acceptable to reuse spatial references.</span>
<span class="s2">- Create **one new snippet per item**.</span>

<span class="s2">Bad example:  </span>
<span class="s2">&#39;If you want, I can stop by the kiosk and get *a newspaper* for tomorrow.&#39; → Incorrect: refers to another item, uses an article instead of a demonstrative determiner.</span>

<span class="s2">---</span>

<span class="s2">```json</span>
<span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s2"></span>
<span class="s2">```</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">all_results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">alldata</span><span class="p">[</span><span class="n">itemid</span><span class="p">]</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">filepointer</span><span class="p">[</span><span class="n">itemid</span><span class="p">]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">get_prompt</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

    <span class="n">allreskey</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">itemid</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">allreskey</span> <span class="ow">in</span> <span class="n">all_results</span><span class="p">:</span>
        <span class="n">all_results</span><span class="p">[</span><span class="n">allreskey</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;person&quot;</span><span class="p">:</span> <span class="n">current</span><span class="p">[</span><span class="s2">&quot;person&quot;</span><span class="p">],</span>
            <span class="s2">&quot;room&quot;</span><span class="p">:</span> <span class="n">current</span><span class="p">[</span><span class="s2">&quot;room&quot;</span><span class="p">],</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
            <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
    <span class="n">current_result</span> <span class="o">=</span> <span class="n">all_results</span><span class="p">[</span><span class="n">allreskey</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">prompt</span> <span class="p">},</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">)</span>

            <span class="n">response_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
            <span class="n">response_data</span> <span class="o">=</span> <span class="n">clean_response</span><span class="p">(</span><span class="n">response_text</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">response_data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">current_result</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_data</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">response_data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">current_result</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_data</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️ Error on attempt </span><span class="si">{</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max retries reached. Skipping this item.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">itemid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alldata</span><span class="p">)):</span>
    <span class="n">process_item</span><span class="p">(</span><span class="n">itemid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/allresults.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">all_results</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">make_single</span><span class="p">(</span><span class="n">listof_lists</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listof_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">listof_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">listof_lists</span>
    <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">listof_lists</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">redo</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">numered_all</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">all_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;items&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">redo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">sublist</span> <span class="o">=</span> <span class="n">make_single</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;items&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">sublist</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sublist</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;snippet&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;new_snippet&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">item</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;new_snippet&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;topic&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;topic:&quot;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">item</span><span class="p">[</span><span class="s2">&quot;topic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;topic:&quot;</span><span class="p">]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;person&quot;</span><span class="p">:</span> <span class="n">all_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;person&quot;</span><span class="p">],</span>
            <span class="s2">&quot;room&quot;</span><span class="p">:</span> <span class="n">all_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;room&quot;</span><span class="p">],</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">all_results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">],</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;topic&quot;</span><span class="p">],</span>
            <span class="s2">&quot;snippet&quot;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;snippet&quot;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="n">numered_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/numered_all.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">numered_all</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o&quot;</span><span class="p">,</span>
    <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">prompt</span> <span class="p">},</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/notes/prompting/openai/hsi/2025/04/28/prompt-testing.html" hidden></a>
</article>

      </div>
    </main><link id="fa-stylesheet" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css">

<footer class="site-footer h-card">
  <data class="u-url" value="/notes/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
      </div>
      <div class="footer-col">
        <p>Things I know I&#39;ll forget</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list">
  <li>
    <a href="https://jimregan.github.io/notes/feed.xml" target="_blank" title="Subscribe to syndication feed">
      <svg class="svg-icon grey" viewbox="0 0 16 16">
        <path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194
          11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.99 2.194-2.2 2.194C.98 16 0 15.017 0
          13.806c0-1.21.983-2.195 2.194-2.195zM10.606
          16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"
        />
      </svg>
    </a>
  </li>
</ul>
</div>

  </div>

</footer>

</body>

</html>
