<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Computing WER on Bark output using wav2vec, whisper, whisperx and stable-ts | notes</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Computing WER on Bark output using wav2vec, whisper, whisperx and stable-ts" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="To get an idea of which sentences were completely hallucinated" />
<meta property="og:description" content="To get an idea of which sentences were completely hallucinated" />
<link rel="canonical" href="https://jimregan.github.io/notes/whisper/wav2vec/wer/2024/03/13/bark-wer.html" />
<meta property="og:url" content="https://jimregan.github.io/notes/whisper/wav2vec/wer/2024/03/13/bark-wer.html" />
<meta property="og:site_name" content="notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-03-13T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://jimregan.github.io/notes/whisper/wav2vec/wer/2024/03/13/bark-wer.html","@type":"BlogPosting","headline":"Computing WER on Bark output using wav2vec, whisper, whisperx and stable-ts","dateModified":"2024-03-13T00:00:00-05:00","datePublished":"2024-03-13T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jimregan.github.io/notes/whisper/wav2vec/wer/2024/03/13/bark-wer.html"},"description":"To get an idea of which sentences were completely hallucinated","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/notes/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://jimregan.github.io/notes/feed.xml" title="notes" /><link rel="shortcut icon" type="image/x-icon" href="/notes/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/notes/">notes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/notes/about/">About Me</a><a class="page-link" href="/notes/search/">Search</a><a class="page-link" href="/notes/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Computing WER on Bark output using wav2vec, whisper, whisperx and stable-ts</h1><p class="page-description">To get an idea of which sentences were completely hallucinated</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2024-03-13T00:00:00-05:00" itemprop="datePublished">
        Mar 13, 2024
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      11 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/notes/categories/#whisper">whisper</a>
        &nbsp;
      
        <a class="category-tags-link" href="/notes/categories/#wav2vec">wav2vec</a>
        &nbsp;
      
        <a class="category-tags-link" href="/notes/categories/#wer">wer</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/jimregan/notes/tree/master/_notebooks/2024-03-13-bark-wer.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/notes/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/jimregan/notes/master?filepath=_notebooks%2F2024-03-13-bark-wer.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/notes/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/jimregan/notes/blob/master/_notebooks/2024-03-13-bark-wer.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/notes/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2024-03-13-bark-wer.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">pipeline</span>
<span class="n">EN_MODEL</span> <span class="o">=</span> <span class="s2">&quot;jonatasgrosman/wav2vec2-large-xlsr-53-english&quot;</span>

<span class="n">pipe_en</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">EN_MODEL</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span>
	<span class="s2">&quot;So, we decided to go to the zoo, and... uh, the first thing we saw was the lions. [laughs] They were just lazing around.&quot;</span><span class="p">,</span>
	<span class="s2">&quot;[gasps] Oh, and you won&#39;t believe the size of the elephants. They were HUGE.&quot;</span><span class="p">,</span>
	<span class="s2">&quot;We were walking past the monkey enclosure when one of them [laughs]—seriously, it started mimicking us!&quot;</span><span class="p">,</span>
	<span class="s2">&quot;[sighs] The weather was kinda hot, but... it was worth it, seeing all those animals up close.&quot;</span><span class="p">,</span>
	<span class="s2">&quot;And the penguins, they were so cute, waddling around. [laughs] I could watch them all day.&quot;</span><span class="p">,</span>
	<span class="s2">&quot;I was a bit scared of the snakes, not gonna lie. Every time one moved, I just... [gasps] jumped a little.&quot;</span><span class="p">,</span>
	<span class="s2">&quot;[clears throat] Oh, and the food there? Surprisingly good. We had these amazing burgers right by the giraffe area.&quot;</span><span class="p">,</span>
	<span class="s2">&quot;The kids were just fascinated by the aquarium section. All those colorful fish and... uh, the sharks were a bit scary, though.&quot;</span><span class="p">,</span>
	<span class="s2">&quot;[laughter] You should&#39;ve seen your face when that parrot started talking! Priceless.&quot;</span><span class="p">,</span>
	<span class="s2">&quot;And... um, at the end of the day, we were all just so tired, but, you know, it was a great day. [sighs] Really special.&quot;</span>
<span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/home/joregan/shivam-sentences&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.wav&quot;</span><span class="p">):</span>
    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">en_out</span> <span class="o">=</span> <span class="n">pipe_en</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">chunk_length_s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_timestamps</span><span class="o">=</span><span class="s2">&quot;word&quot;</span><span class="p">)</span>
    <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">en_out</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">punctuation</span>

<span class="n">PUNCT</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">clean_sentence</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;—&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">word</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">while</span> <span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">PUNCT</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">while</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="n">PUNCT</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clean_sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean_sentence</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.wav&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
<span class="n">text_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]</span>
<span class="n">tmp_sort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">text_out</span><span class="p">)])</span>
<span class="n">hyp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp_sort</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">jiwer</span> <span class="kn">import</span> <span class="n">wer</span>

<span class="n">wer</span><span class="p">(</span><span class="n">clean_sentences</span><span class="p">,</span> <span class="n">hyp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">wer</span><span class="p">(</span><span class="n">clean_sentences</span><span class="p">,</span> <span class="n">hyp</span><span class="p">)</span>
<span class="mf">0.40782122905027934</span>
</pre></div>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">whisper</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">whisper</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;large-v3&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sentences</span><span class="p">):</span>
    <span class="n">file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/home/joregan/shivam-sentences/</span><span class="si">{</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">.wav&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
    <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_wer</span> <span class="o">=</span> <span class="p">[</span><span class="n">wer</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clean_sentences</span><span class="p">,</span> <span class="n">output_text</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output_wer</span>
<span class="p">[</span><span class="mf">0.043478260869565216</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">0.06666666666666667</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3684210526315789</span><span class="p">,</span> <span class="mf">0.045454545454545456</span><span class="p">,</span> <span class="mf">0.18181818181818182</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output_text</span>
<span class="p">[</span><span class="s1">&#39;so we decided to go to the zoo and the first thing we saw was the lions they were just lazing around&#39;</span><span class="p">,</span> <span class="s2">&quot;oh and you won&#39;t believe the size of the elephants they were huge&quot;</span><span class="p">,</span> <span class="s1">&#39;we were walking past the monkey enclosure when one of them seriously it started mimicking us&#39;</span><span class="p">,</span> <span class="s1">&#39;and i was also very very money in the similar silver right or part it was i guess that they were told that they would ask you to pantane with him&#39;</span><span class="p">,</span> <span class="s1">&#39;and the penguins they were so cute like waddling around i could watch them all day&#39;</span><span class="p">,</span> <span class="s1">&#39;i was a bit scared of the snakes not gonna lie every time one moved i just jumped a little&#39;</span><span class="p">,</span> <span class="s1">&#39;um uh oh and the food there uh surprisingly good uh we had these amazing uh burgers right by the garage area uh&#39;</span><span class="p">,</span> <span class="s1">&#39;the kids were just fascinated by the aquarium section all those colorful fish and the sharks were a bit scary though&#39;</span><span class="p">,</span> <span class="s1">&#39;you should have seen your face when that parrot started talking priceless&#39;</span><span class="p">,</span> <span class="s1">&#39;and at the end of the day we were all just so tired but you know it was a great day woo&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputs_self_prompt</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sentences</span><span class="p">):</span>
    <span class="n">file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/home/joregan/shivam-sentences/</span><span class="si">{</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">.wav&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">initial_prompt</span><span class="o">=</span><span class="n">sentence</span><span class="p">)</span>
    <span class="n">outputs_self_prompt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean_sentence</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs_self_prompt</span><span class="p">]</span>
<span class="n">output_wer</span> <span class="o">=</span> <span class="p">[</span><span class="n">wer</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clean_sentences</span><span class="p">,</span> <span class="n">output_text</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output_wer</span>
<span class="p">[</span><span class="mf">0.08695652173913043</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.6875</span><span class="p">,</span> <span class="mf">1.5333333333333334</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.1578947368421053</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.08333333333333333</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>&gt;&gt;&gt; output_text
['uh so we decided to go to the zoo and uh the first thing we saw was the lions um they were just lazing around', "oh and you won't believe the size of the elephants they were huge", 'we were walking past the monkey enclosure when one of them seriously it started mimicking us', 'and i was also very money in a similar silver right or part it was i guess that they were told that they would ask you to pantane with him', "i was like i'm going to go to the zoo i'm going to go to the zoo i'm going to go to the zoo", 'i was a bit scared of the snakes not gonna lie every time one moved i just jumped a little', "the food was so good really i'm so sad to hear this stuff over konnte like another度 doe you in love dana", 'the kids were just fascinated by the aquarium section all those colorful fish and uh the sharks were a bit scary though', "you should've seen your face when that parrot started talking priceless", 'and uh at the end of the day we were all just so tired but you know it was a great day woo really special']</code></pre>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">prune_fillers</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">FILLERS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;uh&quot;</span><span class="p">,</span> <span class="s2">&quot;um&quot;</span><span class="p">]</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FILLERS</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean_sentence</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]</span>
<span class="n">output_nofill</span> <span class="o">=</span> <span class="p">[</span><span class="n">prune_fillers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_text</span><span class="p">]</span>
<span class="n">output_wer</span> <span class="o">=</span> <span class="p">[</span><span class="n">wer</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clean_sentences</span><span class="p">,</span> <span class="n">output_nofill</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output_wer</span>
<span class="p">[</span><span class="mf">0.043478260869565216</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">0.06666666666666667</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.15789473684210525</span><span class="p">,</span> <span class="mf">0.045454545454545456</span><span class="p">,</span> <span class="mf">0.18181818181818182</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean_sentence</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs_self_prompt</span><span class="p">]</span>
<span class="n">output_nofill</span> <span class="o">=</span> <span class="p">[</span><span class="n">prune_fillers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_text</span><span class="p">]</span>
<span class="n">output_wer</span> <span class="o">=</span> <span class="p">[</span><span class="n">wer</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clean_sentences</span><span class="p">,</span> <span class="n">output_nofill</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output_wer</span>
<span class="p">[</span><span class="mf">0.043478260869565216</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.6875</span><span class="p">,</span> <span class="mf">1.5333333333333334</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.1578947368421053</span><span class="p">,</span> <span class="mf">0.045454545454545456</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.08333333333333333</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">output_nofill</span>
<span class="p">[</span><span class="s1">&#39;so we decided to go to the zoo and the first thing we saw was the lions they were just lazing around&#39;</span><span class="p">,</span> <span class="s2">&quot;oh and you won&#39;t believe the size of the elephants they were huge&quot;</span><span class="p">,</span> <span class="s1">&#39;we were walking past the monkey enclosure when one of them seriously it started mimicking us&#39;</span><span class="p">,</span> <span class="s1">&#39;and i was also very money in a similar silver right or part it was i guess that they were told that they would ask you to pantane with him&#39;</span><span class="p">,</span> <span class="s2">&quot;i was like i&#39;m going to go to the zoo i&#39;m going to go to the zoo i&#39;m going to go to the zoo&quot;</span><span class="p">,</span> <span class="s1">&#39;i was a bit scared of the snakes not gonna lie every time one moved i just jumped a little&#39;</span><span class="p">,</span> <span class="s2">&quot;the food was so good really i&#39;m so sad to hear this stuff over konnte like another度 doe you in love dana&quot;</span><span class="p">,</span> <span class="s1">&#39;the kids were just fascinated by the aquarium section all those colorful fish and the sharks were a bit scary though&#39;</span><span class="p">,</span> <span class="s2">&quot;you should&#39;ve seen your face when that parrot started talking priceless&quot;</span><span class="p">,</span> <span class="s1">&#39;and at the end of the day we were all just so tired but you know it was a great day woo really special&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output_nofill</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;so we decided to go to the zoo and the first thing we saw was the lions they were just lazing around&#39;</span><span class="p">,</span> <span class="s2">&quot;oh and you won&#39;t believe the size of the elephants they were huge&quot;</span><span class="p">,</span> <span class="s1">&#39;we were walking past the monkey enclosure when one of them seriously it started mimicking us&#39;</span><span class="p">,</span> <span class="s1">&#39;and i was also very money in a similar silver right or part it was i guess that they were told that they would ask you to pantane with him&#39;</span><span class="p">,</span> <span class="s2">&quot;i was like i&#39;m going to go to the zoo i&#39;m going to go to the zoo i&#39;m going to go to the zoo&quot;</span><span class="p">,</span> <span class="s1">&#39;i was a bit scared of the snakes not gonna lie every time one moved i just jumped a little&#39;</span><span class="p">,</span> <span class="s2">&quot;the food was so good really i&#39;m so sad to hear this stuff over konnte like another度 doe you in love dana&quot;</span><span class="p">,</span> <span class="s1">&#39;the kids were just fascinated by the aquarium section all those colorful fish and the sharks were a bit scary though&#39;</span><span class="p">,</span> <span class="s2">&quot;you should&#39;ve seen your face when that parrot started talking priceless&quot;</span><span class="p">,</span> <span class="s1">&#39;and at the end of the day we were all just so tired but you know it was a great day woo really special&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sentences</span><span class="p">,</span> <span class="n">output_nofill</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>So, we decided to go to the zoo, and... uh, the first thing we saw was the lions. [laughs] They were just lazing around.
so we decided to go to the zoo and the first thing we saw was the lions they were just lazing around

[gasps] Oh, and you won&#39;t believe the size of the elephants. They were HUGE.
oh and you won&#39;t believe the size of the elephants they were huge

We were walking past the monkey enclosure when one of them [laughs]—seriously, it started mimicking us!
we were walking past the monkey enclosure when one of them seriously it started mimicking us

[sighs] The weather was kinda hot, but... it was worth it, seeing all those animals up close.
and i was also very money in a similar silver right or part it was i guess that they were told that they would ask you to pantane with him

And the penguins, they were so cute, waddling around. [laughs] I could watch them all day.
i was like i&#39;m going to go to the zoo i&#39;m going to go to the zoo i&#39;m going to go to the zoo

I was a bit scared of the snakes, not gonna lie. Every time one moved, I just... [gasps] jumped a little.
i was a bit scared of the snakes not gonna lie every time one moved i just jumped a little

[clears throat] Oh, and the food there? Surprisingly good. We had these amazing burgers right by the giraffe area.
the food was so good really i&#39;m so sad to hear this stuff over konnte like another度 doe you in love dana

The kids were just fascinated by the aquarium section. All those colorful fish and... uh, the sharks were a bit scary, though.
the kids were just fascinated by the aquarium section all those colorful fish and the sharks were a bit scary though

[laughter] You should&#39;ve seen your face when that parrot started talking! Priceless.
you should&#39;ve seen your face when that parrot started talking priceless

And... um, at the end of the day, we were all just so tired, but, you know, it was a great day. [sighs] Really special.
and at the end of the day we were all just so tired but you know it was a great day woo really special

</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentences</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;[sighs] The weather was kinda hot, but... it was worth it, seeing all those animals up close.&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">whisper</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;medium.en&quot;</span><span class="p">)</span>
<span class="mi">100</span><span class="o">%|</span><span class="err">█████████████████████████████████████</span><span class="o">|</span> <span class="mf">1.42</span><span class="n">G</span><span class="o">/</span><span class="mf">1.42</span><span class="n">G</span> <span class="p">[</span><span class="mi">02</span><span class="p">:</span><span class="mi">01</span><span class="o">&lt;</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mf">12.6</span><span class="n">MiB</span><span class="o">/</span><span class="n">s</span><span class="p">]</span><span class="o">&gt;</span> <span class="o">&gt;&gt;</span> <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sentences</span><span class="p">):</span><span class="o">...</span>     <span class="n">file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/home/joregan/shivam-sentences/</span><span class="si">{</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">.wav&quot;</span><span class="o">...</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="o">...</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">output_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">clean_sentence</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">output_nofill</span> <span class="o">=</span> <span class="p">[</span><span class="n">prune_fillers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_text</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">output_wer</span> <span class="o">=</span> <span class="p">[</span><span class="n">wer</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">clean_sentences</span><span class="p">,</span> <span class="n">output_nofill</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">output_wer</span>
<span class="p">[</span><span class="mf">0.043478260869565216</span><span class="p">,</span> <span class="mf">0.07692307692307693</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="mf">0.06666666666666667</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.15789473684210525</span><span class="p">,</span> <span class="mf">0.045454545454545456</span><span class="p">,</span> <span class="mf">0.18181818181818182</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">stable_whisper</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">stable_whisper</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;medium.en&#39;</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sentences</span><span class="p">):</span>
    <span class="n">file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/home/joregan/shivam-sentences/</span><span class="si">{</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">.wav&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
    <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

<span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">all_words</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">word</span><span class="o">.</span><span class="n">_start</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">word</span><span class="o">.</span><span class="n">_end</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">word</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">stable_whisper</span>


<span class="k">def</span> <span class="nf">get_args</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="s2">&quot;Transcribe a directory of wav files&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;wav_directory&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;tsv_directory&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">args</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">()</span>

    <span class="n">indir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">wav_directory</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">tsv_directory</span><span class="p">:</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">tsv_directory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">indir</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">stable_whisper</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;medium.en&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">wav</span> <span class="ow">in</span> <span class="n">indir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.wav&quot;</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wav</span><span class="p">),</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wav</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.tsv&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">of</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">all_words</span><span class="p">():</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">word</span><span class="o">.</span><span class="n">_start</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">word</span><span class="o">.</span><span class="n">_end</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">word</span><span class="o">.</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">whisperx</span>
<span class="kn">import</span> <span class="nn">torch</span>


<span class="k">def</span> <span class="nf">get_args</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="s2">&quot;Transcribe a directory of wav files&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;wav_directory&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;tsv_directory&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">args</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">()</span>

    <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>

    <span class="n">indir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">wav_directory</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">tsv_directory</span><span class="p">:</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">tsv_directory</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="n">indir</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">whisperx</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;medium.en&quot;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">wav</span> <span class="ow">in</span> <span class="n">indir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.wav&quot;</span><span class="p">):</span>
        <span class="n">audio</span> <span class="o">=</span> <span class="n">whisperx</span><span class="o">.</span><span class="n">load_audio</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wav</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transcribe</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
        <span class="n">model_a</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">whisperx</span><span class="o">.</span><span class="n">load_align_model</span><span class="p">(</span><span class="n">language_code</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">whisperx</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">&quot;segments&quot;</span><span class="p">],</span> <span class="n">model_a</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">audio</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">return_char_alignments</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">outdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wav</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.tsv&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">of</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;word_segments&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;word_segments&quot;</span><span class="p">]:</span>
                    <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;word&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/notes/whisper/wav2vec/wer/2024/03/13/bark-wer.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/notes/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://jimregan.github.io/notes/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/notes/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Things I know I&#39;ll forget</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
